# 영상통화 테스트 가이드

## 준비물
- 최소 2개의 계정 (Supabase에 등록된)
- 웹캠과 마이크 권한

## 테스트 방법 1: 시크릿 모드 (추천)

### 1단계: 첫 번째 사용자 로그인
1. **일반 브라우저 창** 열기
2. `http://localhost:5173` 접속
3. 계정1로 로그인 (예: user1@test.com)
4. Live 페이지로 이동

### 2단계: 두 번째 사용자 로그인
1. **시크릿/프라이빗 창** 열기 (Ctrl+Shift+N 또는 Cmd+Shift+N)
2. `http://localhost:5173` 접속
3. 계정2로 로그인 (예: user2@test.com)
4. Live 페이지로 이동

### 3단계: 창 배치
- 두 창을 화면에 나란히 배치 (좌우 또는 상하)
- 각 창에서 디버그 정보로 사용자 확인

### 4단계: 통화 테스트

**시나리오 A: 계정1 → 계정2 통화**
1. 계정1 창에서 계정2의 "영상통화" 버튼 클릭
2. 계정2 창에 수신 통화 모달이 나타나는지 확인
3. 계정2에서 "수락" 또는 "거절" 버튼 클릭

**시나리오 B: 계정2 → 계정1 통화**
1. 계정2 창에서 계정1의 "영상통화" 버튼 클릭
2. 계정1 창에 수신 통화 모달이 나타나는지 확인
3. 계정1에서 "수락" 클릭
4. VideoCall 페이지에서 영상통화 진행

---

## 테스트 방법 2: 다른 브라우저

### Chrome + Firefox
1. Chrome: 계정1로 로그인
2. Firefox: 계정2로 로그인
3. 동일하게 Live 페이지에서 테스트

---

## 콘솔 로그 확인

브라우저 개발자 도구 (F12)의 Console 탭에서 다음 로그 확인:

### 발신자 (통화 거는 쪽)
```
🔵 Live - 통화 시작: [상대방 닉네임]
✅ Live - 통화 생성 완료: [call_id]
```

### 수신자 (통화 받는 쪽)
```
🔵 Live - 수신 통화 구독 시작: [user_id]
🔵 Live - 수신 통화: {callId: "...", caller: {...}}
```

### 수락 시
```
🔵 Live - 통화 수락: [call_id]
```

### 거절 시
```
🔵 Live - 통화 거절: [call_id]
```

---

## 체크리스트

- [ ] 두 계정으로 동시 로그인 완료
- [ ] Live 페이지에서 서로의 프로필이 보임
- [ ] 영상통화 버튼 클릭 시 상대방에게 알림 표시
- [ ] 수신 통화 모달이 올바르게 표시됨
- [ ] "수락" 버튼 클릭 시 VideoCall 페이지로 이동
- [ ] "거절" 버튼 클릭 시 모달 닫힘
- [ ] 웹캠/마이크 권한 요청 표시

---

## 문제 해결

### 수신 통화가 표시되지 않는 경우
1. 콘솔에서 "🔵 Live - 수신 통화 구독 시작" 로그 확인
2. Supabase 대시보드에서 `video_calls` 테이블 확인
3. 브라우저 새로고침 후 재시도

### 영상통화 버튼이 동작하지 않는 경우
1. `video_calls` 테이블이 Supabase에 존재하는지 확인
2. 사용자 ID가 올바른지 확인 (디버그 정보 참조)

### 웹캠이 작동하지 않는 경우
1. 브라우저 설정에서 카메라/마이크 권한 확인
2. HTTPS 또는 localhost에서만 작동 (HTTP는 불가)

---

## 다음 단계

통화 수락 후 VideoCall 페이지가 정상적으로 작동하는지 확인:
- 로컬 비디오 표시
- 원격 비디오 표시
- 음소거/비디오 끄기 버튼
- 통화 종료 버튼
