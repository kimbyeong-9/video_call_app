# ğŸ¤ ì¹œêµ¬ ì¶”ê°€ ê¸°ëŠ¥ ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

Home í˜ì´ì§€ì˜ ì‹¤ì‹œê°„ ì¶”ì²œ ì¹´ë“œì—ì„œ ì‚¬ìš©ìë¥¼ **ì¹œêµ¬ë¡œ ì¶”ê°€/ì œê±°**í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (í•„ìˆ˜)

### 1ë‹¨ê³„: Supabase Dashboard ì ‘ì†

1. https://supabase.com/dashboard ì ‘ì†
2. ë¡œê·¸ì¸
3. í”„ë¡œì íŠ¸ ì„ íƒ: `copqtgkymbhdayglatqg`

### 2ë‹¨ê³„: SQL Editorì—ì„œ í…Œì´ë¸” ìƒì„±

1. ì™¼ìª½ ì‚¬ì´ë“œë°” â†’ **SQL Editor** í´ë¦­
2. ìƒˆ ì¿¼ë¦¬ ì‘ì„±
3. `create_friends_table.sql` íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°
4. **Run** ë²„íŠ¼ í´ë¦­

### SQL ë‚´ìš© (ìš”ì•½)

```sql
-- friends í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS friends (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  friend_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  UNIQUE(user_id, friend_id),
  CHECK (user_id != friend_id)
);

-- RLS ì •ì±… ì„¤ì •
ALTER TABLE friends ENABLE ROW LEVEL SECURITY;

-- ì¡°íšŒ ê¶Œí•œ: ìì‹ ì˜ ì¹œêµ¬ ëª©ë¡ë§Œ
CREATE POLICY "friends_select_policy"
ON friends FOR SELECT TO authenticated
USING (auth.uid() = user_id OR auth.uid() = friend_id);

-- ì¶”ê°€ ê¶Œí•œ: ìì‹ ì˜ ì¹œêµ¬ë§Œ ì¶”ê°€ ê°€ëŠ¥
CREATE POLICY "friends_insert_policy"
ON friends FOR INSERT TO authenticated
WITH CHECK (auth.uid() = user_id);

-- ì‚­ì œ ê¶Œí•œ: ìì‹ ì˜ ì¹œêµ¬ë§Œ ì‚­ì œ ê°€ëŠ¥
CREATE POLICY "friends_delete_policy"
ON friends FOR DELETE TO authenticated
USING (auth.uid() = user_id);
```

---

## ğŸ¨ UI ë³€ê²½ì‚¬í•­

### ì´ì „ (Before)
```
[ğŸ’— ì¢‹ì•„ìš”] [ğŸ’¬ ë©”ì‹œì§€]
```

### ì´í›„ (After)
```
[ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€] [ğŸ’¬ ë©”ì‹œì§€]  (ì¹œêµ¬ ì•„ë‹ ë•Œ - ì£¼í™©ìƒ‰)
[âœ“ ì¹œêµ¬] [ğŸ’¬ ë©”ì‹œì§€]         (ì¹œêµ¬ì¼ ë•Œ - ì´ˆë¡ìƒ‰)
```

---

## ğŸ¯ ê¸°ëŠ¥ ì„¤ëª…

### 1. ì¹œêµ¬ ì¶”ê°€ ë²„íŠ¼

| ìƒíƒœ | ì•„ì´ì½˜ | ìƒ‰ìƒ | ë™ì‘ |
|------|--------|------|------|
| **ì¹œêµ¬ ì•„ë‹˜** | `FiUserPlus` (ğŸ‘¤+) | ì£¼í™©ìƒ‰ | í´ë¦­ ì‹œ ì¹œêµ¬ë¡œ ì¶”ê°€ |
| **ì¹œêµ¬ì„** | `FiUserCheck` (âœ“) | ì´ˆë¡ìƒ‰ | í´ë¦­ ì‹œ ì¹œêµ¬ ì œê±° |

### 2. ë²„íŠ¼ ìƒ‰ìƒ

```javascript
// ì¹œêµ¬ ì¶”ê°€ (ì£¼í™©ìƒ‰)
background: 'linear-gradient(135deg, #FF9800 0%, #FFB74D 100%)'

// ì¹œêµ¬ ì¶”ê°€ë¨ (ì´ˆë¡ìƒ‰)
background: 'linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%)'

// ë©”ì‹œì§€ (ë³´ë¼ìƒ‰)
background: 'linear-gradient(135deg, #667EEA 0%, #764BA2 100%)'
```

---

## ğŸ”„ ì‘ë™ ë°©ì‹

### ì¹œêµ¬ ì¶”ê°€ í”„ë¡œì„¸ìŠ¤

```
1. ì‚¬ìš©ìê°€ [ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€] ë²„íŠ¼ í´ë¦­
   â†“
2. Supabase friends í…Œì´ë¸”ì— ë°ì´í„° INSERT
   {
     user_id: í˜„ì¬_ì‚¬ìš©ì_ID,
     friend_id: ì¶”ê°€í• _ì¹œêµ¬_ID
   }
   â†“
3. ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸ (friendsList)
   â†“
4. ë²„íŠ¼ ì•„ì´ì½˜/ìƒ‰ìƒ ë³€ê²½: [âœ“ ì¹œêµ¬] (ì´ˆë¡ìƒ‰)
   â†“
5. ì•Œë¦¼ í‘œì‹œ: "OOOë‹˜ì„ ì¹œêµ¬ë¡œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!"
```

### ì¹œêµ¬ ì œê±° í”„ë¡œì„¸ìŠ¤

```
1. ì‚¬ìš©ìê°€ [âœ“ ì¹œêµ¬] ë²„íŠ¼ í´ë¦­
   â†“
2. Supabase friends í…Œì´ë¸”ì—ì„œ ë°ì´í„° DELETE
   WHERE user_id = í˜„ì¬_ì‚¬ìš©ì_ID
   AND friend_id = ì œê±°í• _ì¹œêµ¬_ID
   â†“
3. ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸ (friendsList)
   â†“
4. ë²„íŠ¼ ì•„ì´ì½˜/ìƒ‰ìƒ ë³€ê²½: [ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€] (ì£¼í™©ìƒ‰)
   â†“
5. ì•Œë¦¼ í‘œì‹œ: "OOOë‹˜ì„ ì¹œêµ¬ ëª©ë¡ì—ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤."
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1ë‹¨ê³„: í…Œì´ë¸” ìƒì„± í™•ì¸

Supabase SQL Editorì—ì„œ ì‹¤í–‰:

```sql
-- friends í…Œì´ë¸” í™•ì¸
SELECT * FROM friends LIMIT 5;

-- RLS ì •ì±… í™•ì¸
SELECT
  schemaname,
  tablename,
  policyname,
  cmd
FROM pg_policies
WHERE tablename = 'friends';
```

### 2ë‹¨ê³„: ì•±ì—ì„œ í…ŒìŠ¤íŠ¸

1. **ë¸Œë¼ìš°ì € 1**: ì‚¬ìš©ì Aë¡œ ë¡œê·¸ì¸
2. Home í˜ì´ì§€ â†’ ì‹¤ì‹œê°„ ì¶”ì²œ ì¹´ë“œì—ì„œ ì‚¬ìš©ì B ì°¾ê¸°
3. **[ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€]** ë²„íŠ¼ í´ë¦­
4. âœ… ë²„íŠ¼ì´ **[âœ“ ì¹œêµ¬]** (ì´ˆë¡ìƒ‰)ë¡œ ë³€ê²½ í™•ì¸
5. âœ… ì•Œë¦¼: "OOOë‹˜ì„ ì¹œêµ¬ë¡œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!" í™•ì¸

### 3ë‹¨ê³„: Friends í˜ì´ì§€ í™•ì¸

1. í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ â†’ **Friends** íƒ­ í´ë¦­
2. âœ… ì¶”ê°€í•œ ì¹œêµ¬ê°€ ëª©ë¡ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

### 4ë‹¨ê³„: ì¹œêµ¬ ì œê±° í…ŒìŠ¤íŠ¸

1. Home í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
2. ê°™ì€ ì‚¬ìš©ì ì¹´ë“œì—ì„œ **[âœ“ ì¹œêµ¬]** ë²„íŠ¼ í´ë¦­
3. âœ… ë²„íŠ¼ì´ **[ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€]** (ì£¼í™©ìƒ‰)ë¡œ ë³€ê²½ í™•ì¸
4. âœ… ì•Œë¦¼: "OOOë‹˜ì„ ì¹œêµ¬ ëª©ë¡ì—ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤." í™•ì¸

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### friends í…Œì´ë¸”

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `id` | UUID | Primary Key (ìë™ ìƒì„±) |
| `user_id` | UUID | ì¹œêµ¬ ì¶”ê°€ë¥¼ ìš”ì²­í•œ ì‚¬ìš©ì ID |
| `friend_id` | UUID | ì¶”ê°€ëœ ì¹œêµ¬ì˜ ì‚¬ìš©ì ID |
| `created_at` | TIMESTAMP | ì¹œêµ¬ ì¶”ê°€ ì‹œê° |

### ì œì•½ ì¡°ê±´

1. **UNIQUE(user_id, friend_id)**: ì¤‘ë³µ ë°©ì§€
2. **CHECK (user_id != friend_id)**: ìê¸° ìì‹  ì¶”ê°€ ë°©ì§€
3. **FOREIGN KEY**: users í…Œì´ë¸”ê³¼ ì—°ê²° (CASCADE ì‚­ì œ)

---

## ğŸ” ë³´ì•ˆ (RLS)

### RLS ì •ì±… ìš”ì•½

| ì‘ì—… | ê¶Œí•œ |
|------|------|
| **SELECT** | ë³¸ì¸ì´ ì¶”ê°€í•œ ì¹œêµ¬ ë˜ëŠ” ë³¸ì¸ì„ ì¶”ê°€í•œ ì¹œêµ¬ |
| **INSERT** | ë³¸ì¸ì´ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ì¹œêµ¬ë¡œ ì¶”ê°€ |
| **DELETE** | ë³¸ì¸ì´ ì¶”ê°€í•œ ì¹œêµ¬ë§Œ ì‚­ì œ ê°€ëŠ¥ |
| **UPDATE** | í—ˆìš© ì•ˆ í•¨ (í•„ìš” ì—†ìŒ) |

---

## â“ ë¬¸ì œ í•´ê²°

### 1. "ì‘ì—…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" ì—ëŸ¬

**ì›ì¸**: friends í…Œì´ë¸”ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ê±°ë‚˜ RLS ì •ì±…ì´ ì—†ìŒ

**í•´ê²°**:
1. Supabase SQL Editorì—ì„œ `create_friends_table.sql` ì‹¤í–‰
2. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨

### 2. ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ë³€í™”ê°€ ì—†ìŒ

**ì›ì¸**: ë¸Œë¼ìš°ì € ìºì‹œ ë˜ëŠ” ë¡œê·¸ì¸ ì„¸ì…˜ ë¬¸ì œ

**í•´ê²°**:
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ì‹¤í–‰
localStorage.clear();
sessionStorage.clear();
location.reload();
```

### 3. Friends í˜ì´ì§€ì— ì¹œêµ¬ê°€ ì•ˆ ë³´ì„

**ì›ì¸**: Friends í˜ì´ì§€ê°€ friends í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

**í•´ê²°**: Friends í˜ì´ì§€ ì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ Supabaseì—ì„œ ì¹œêµ¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

```javascript
// src/pages/Friends/index.jsx
const loadFriends = async () => {
  const { data: { session } } = await supabase.auth.getSession();
  
  const { data: friends } = await supabase
    .from('friends')
    .select(`
      friend_id,
      users!friend_id (
        id,
        nickname,
        email,
        profile_image,
        bio,
        interests
      )
    `)
    .eq('user_id', session.user.id);
  
  setFriends(friends);
};
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Supabaseì—ì„œ `create_friends_table.sql` ì‹¤í–‰
- [ ] friends í…Œì´ë¸” ìƒì„± í™•ì¸
- [ ] RLS ì •ì±… í™•ì¸
- [ ] Home í˜ì´ì§€ì—ì„œ ì¹œêµ¬ ì¶”ê°€ í…ŒìŠ¤íŠ¸
- [ ] ì¹œêµ¬ ì œê±° í…ŒìŠ¤íŠ¸
- [ ] ì•Œë¦¼ ë©”ì‹œì§€ í™•ì¸
- [ ] Friends í˜ì´ì§€ì—ì„œ ì¹œêµ¬ ëª©ë¡ í™•ì¸

---

## ğŸ‰ ì™„ë£Œ!

ì´ì œ Home í˜ì´ì§€ì—ì„œ:
- âœ… **[ğŸ‘¤+ ì¹œêµ¬ì¶”ê°€]** ë²„íŠ¼ìœ¼ë¡œ ì¹œêµ¬ ì¶”ê°€
- âœ… **[âœ“ ì¹œêµ¬]** ë²„íŠ¼ìœ¼ë¡œ ì¹œêµ¬ ì œê±°
- âœ… ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
- âœ… ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©ì í”¼ë“œë°±

**ì¹œêµ¬ ì¶”ê°€ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!** ğŸš€

